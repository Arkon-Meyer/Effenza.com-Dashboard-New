name: Project Auto Status

on:
  issues:
    types: [opened, reopened, closed, labeled]
  pull_request:
    types: [opened, ready_for_review, synchronize, closed]
  workflow_dispatch:
  schedule:
    # Run daily at 07:00 UTC
    - cron: '0 7 * * *'

permissions:
  contents: read
  issues: write
  pull-requests: read

env:
  PROJECT_OWNER: Arkon-Meyer
  PROJECT_NUMBER: "2"

jobs:
  issue-events:
    if: github.event_name == 'issues'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Auth with PAT
        run: gh auth login --with-token <<< "${{ secrets.GH_PROJECT_TOKEN }}"
      - name: Update project status (issues)
        run: scripts/project-set-status.sh

  pr-events:
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Auth with PAT
        run: gh auth login --with-token <<< "${{ secrets.GH_PROJECT_TOKEN }}"
      - name: Update project status (PRs)
        run: scripts/project-set-status.sh

  reconcile:
    if: github.event_name == 'schedule' || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Auth with PAT
        run: gh auth login --with-token <<< "${{ secrets.GH_PROJECT_TOKEN }}"
      - name: Reconcile board (titles â†’ Status)
        run: scripts/project-set-status.sh
